{% set max_width = 'max-w-7xl mx-auto w-full' %}
{% set section_padding = 'px-4 sm:px-6 lg:px-8' %}
{% set site_js = 'user://themes/metricalo-base/dist/js/main.js?v=3' %}
{% set data = config.data %}
{% block render_block %}{% endblock %}

{% do assets.addJs('theme://assets/js/animation.js', {group: 'bottom', loading: 'defer'}) %}

<script>
    document.addEventListener("DOMContentLoaded", function () {


        //FAQ accordion
        const accordionButtons = document.querySelectorAll(".faq-accordion-header");

        accordionButtons.forEach((button) => {
            button.addEventListener("click", function () {
                const targetId = button.getAttribute("data-target");
                const body = document.querySelector(targetId);
                const parentItem = button.closest(".faq-accordion-item");
                const upIcon = parentItem.querySelector(".faq-accordion-up-btn");
                const downIcon = parentItem.querySelector(".faq-accordion-down-btn");

                const isOpen = !body.classList.contains("d-none");

                if (isOpen) {
                    setTimeout(() => {
                        body.style.height = 0 + "px";
                    }, 10);

                    setTimeout(() => {
                        body.classList.add("d-none");
                    }, 15);

                    upIcon.classList.add("d-none");
                    downIcon.classList.remove("d-none");
                } else {
                    setTimeout(() => {
                        body.style.height = 100 + "%";
                    }, 10);

                    setTimeout(() => {
                        body.classList.remove("d-none");
                    }, 15);

                    upIcon.classList.remove("d-none");
                    downIcon.classList.add("d-none");
                }
            });
        });
    });
</script>

<script>
  document.addEventListener("DOMContentLoaded", function () {

    const track = document.querySelector(".image-contents");
    const originalItems = Array.from(document.querySelectorAll(".slider_images"));
    const paginationContainer = document.querySelector(".hero-slider-pagination");
    const autoSlideInterval = 3000;

    let currentIndex = 0, visibleItems, itemWidth, autoSlideTimer;

    function getVisibleItemsCount() {
      if (window.innerWidth < 700) return 1;
      if (window.innerWidth < 1024) return 3;
      return 5;
    }

    function initializeSlider() {
      visibleItems = getVisibleItemsCount();

      while (track.children.length > originalItems.length) {
        track.removeChild(track.lastChild);
      }

      track.style.transition = 'none';
      track.style.transform = 'translateX(0)';

      const clonesBefore = originalItems.slice(-visibleItems).map(item => item.cloneNode(true));
      const clonesAfter = originalItems.slice(0, visibleItems).map(item => item.cloneNode(true));

      clonesBefore.forEach(clone => track.insertBefore(clone, track.firstChild));
      clonesAfter.forEach(clone => track.appendChild(clone));

      itemWidth = track.querySelector(".slider_images").offsetWidth;
      currentIndex = visibleItems;
      track.style.transform = `translateX(-${currentIndex * itemWidth}px)`;

      generateBullets();
      updateImageSizes();
      startAutoSlide();

      void track.offsetWidth;
      track.style.transition = 'transform 0.5s ease-in-out';
    }

    function updateSliderPosition() {
      track.style.transform = `translateX(-${currentIndex * itemWidth}px)`;
      updateBullets();
      updateImageSizes();
    }

    function nextSlide() {
      currentIndex++;
      track.style.transition = 'transform 0.5s ease-in-out';

      if (currentIndex >= originalItems.length + visibleItems) {
        setTimeout(() => {
          track.style.transition = 'none';
          currentIndex = visibleItems;
          track.style.transform = `translateX(-${currentIndex * itemWidth}px)`;
          void track.offsetWidth;
          track.style.transition = 'transform 0.5s ease-in-out';
        }, 500);
      }

      updateSliderPosition();
    }

    function updateImageSizes() {
      const allImages = document.querySelectorAll(".slider_images");
      const middleIndex = Math.floor(visibleItems / 2);

      allImages.forEach((item, index) => {
        const isMiddle = (index - currentIndex) === middleIndex;
        item.style.transform = isMiddle ? "scale(1.2)" : "scale(1)";
        item.style.padding = isMiddle ? "12px" : "0";
        item.style.zIndex = isMiddle ? "10" : "1";
      });
    }

    function generateBullets() {
      paginationContainer.innerHTML = "";
      for (let i = 0; i < 7; i++) {
        const bullet = document.createElement("div");
        bullet.className = "bullet";
        paginationContainer.appendChild(bullet);
      }
      updateBullets();
    }

    function updateBullets() {
      const bullets = document.querySelectorAll(".bullet");
      if (!bullets.length) return;

      const activeIndex = ((currentIndex - visibleItems) % 7 + 7) % 7;

      bullets.forEach((bullet, index) => {
        bullet.classList.toggle("active", index === activeIndex);
      });
    }

// Auto-slide controls
    function startAutoSlide() {
      stopAutoSlide();
      autoSlideTimer = setInterval(nextSlide, autoSlideInterval);
    }

    function stopAutoSlide() {
      clearInterval(autoSlideTimer);
    }

    function restartAutoSlide() {
      stopAutoSlide();
      startAutoSlide();
    }

    track.addEventListener("mouseenter", stopAutoSlide);
    track.addEventListener("mouseleave", startAutoSlide);

    let resizeTimeout;
    window.addEventListener("resize", () => {
      clearTimeout(resizeTimeout);
      resizeTimeout = setTimeout(initializeSlider, 100);
    });

    initializeSlider();




  // TODO: FAQ Only one open
  // const accordionButtons = document.querySelectorAll(".faq-accordion-header");

  // accordionButtons.forEach((button, index) => {
  //   button.addEventListener("click", function () {
  //     console.log("Clicked Index:", index);
  //     const targetId = button.getAttribute("data-target");
  //     const body = document.querySelector(targetId);
  //     const parentItem = button.closest(".faq-accordion-item");
  //     const upIcon = parentItem.querySelector(".faq-accordion-up-btn");
  //     const downIcon = parentItem.querySelector(".faq-accordion-down-btn");
  //     const itemId = document.querySelector(`#item-${index}`);
  //
  //     const isOpen = !body.classList.contains("d-none");
  //
  //     document.querySelectorAll("[id^='item-']").forEach((item) => {
  //       item.classList.remove("selected");
  //     });
  //
  //     if (isOpen) {
  //       body.style.height = "0px";
  //
  //       setTimeout(() => {
  //         body.classList.add("d-none");
  //         itemId.classList.remove("selected");
  //       }, 150);
  //
  //       upIcon.classList.add("d-none");
  //       downIcon.classList.remove("d-none");
  //     } else {
  //       document.querySelectorAll(".faq-accordion-body").forEach((item) => {
  //         item.style.height = "0px";
  //         item.classList.add("d-none");
  //       });
  //
  //       document.querySelectorAll(".faq-accordion-up-btn").forEach((icon) => icon.classList.add("d-none"));
  //       document.querySelectorAll(".faq-accordion-down-btn").forEach((icon) => icon.classList.remove("d-none"));
  //
  //       setTimeout(() => {
  //         body.classList.remove("d-none");
  //         body.style.height = "100%";
  //         itemId.classList.add("selected");
  //       }, 150);
  //
  //       upIcon.classList.remove("d-none");
  //       downIcon.classList.add("d-none");
  //     }
  //   });
  // });
});

</script>